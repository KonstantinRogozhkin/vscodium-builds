# Документация по скриптам сборки VSCodium

Этот документ содержит описание назначения и использования скриптов в директории `dev/` проекта VSCodium.

## Содержание
1. [build.env](#buildenv) - Файл с переменными окружения для сборки
2. [build.ps1](#buildps1) - PowerShell скрипт для запуска сборки на Windows
3. [build.sh](#buildsh) - Основной скрипт сборки для Linux/macOS
4. [build_docker.sh](#build_dockersh) - Скрипт для сборки в Docker-контейнере
5. [cli.sh](#clish) - Скрипт для работы с CLI VSCodium
6. [patch.sh](#patchsh) - Утилита для применения патчей
7. [update_api.sh](#update_apish) - Скрипт для обновления API VSCode
8. [update_patches.sh](#update_patchessh) - Утилита для обновления патчей

---

## build.env

**Назначение**: Файл с переменными окружения, используемыми при сборке VSCodium.

**Содержимое**:
- `MS_TAG` - Версия Microsoft VSCode, на основе которой собирается VSCodium
- `MS_COMMIT` - Хеш коммита репозитория VSCode
- `RELEASE_VERSION` - Версия выпуска VSCodium
- `BUILD_SOURCEVERSION` - Хеш версии исходного кода

**Использование**:
```bash
# Загрузка переменных в текущую сессию
source build.env
```

---

## build.ps1

**Назначение**: PowerShell скрипт для запуска сборки VSCodium на Windows.

**Особенности**:
- Устанавливает правильный путь к утилитам Git
- Запускает основной скрипт сборки `build.sh`

**Использование**:
```powershell
.\build.ps1
```

---

## build.sh

**Назначение**: Основной скрипт для сборки VSCodium на Linux/macOS.

**Ключи командной строки**:
- `-i` - Сборка инсайдерской версии (insider)
- `-l` - Сборка последней версии
- `-o` - Пропустить сборку (только подготовка)
- `-p` - Не пропускать загрузку ассетов
- `-s` - Пропустить загрузку исходного кода

**Экспортируемые переменные**:
- `APP_NAME` - Название приложения (по умолчанию "VSCodium")
- `BINARY_NAME` - Имя исполняемого файла (по умолчанию "codium")
- `VSCODE_QUALITY` - Качество сборки ("stable" или "insider")
- `VSCODE_ARCH` - Архитектура процессора (x64, arm64, armhf)

**Использование**:
```bash
# Сборка стабильной версии
./build.sh

# Сборка инсайдерской версии
./build.sh -i
```

---

## build_docker.sh

**Назначение**: Скрипт для сборки VSCodium в Docker-контейнере.

**Ключи командной строки**:
- `-i` - Сборка инсайдерской версии
- `-l` - Сборка последней версии
- `-p` - Не пропускать загрузку ассетов

**Особенности**:
- Автоматически определяет архитектуру системы
- Настраивает окружение для работы в контейнере
- Запускает основной скрипт сборки

**Использование**:
```bash
# Сборка стабильной версии в контейнере
./build_docker.sh
```

---

## cli.sh

**Назначение**: Скрипт для работы с командной строкой VSCodium.

**Особенности**:
- Настраивает переменные окружения для работы с VSCodium CLI
- Собирает и настраивает серверную часть VSCodium
- Используется в основном для отладки и разработки

**Использование**:
```bash
./cli.sh
```

---

## patch.sh

**Назначение**: Утилита для применения патчей к исходному коду VSCode.

**Особенности**:
- Применяет патчи из директории `../patches/`
- Поддерживает откат изменений при конфликтах
- Автоматически создает резервные копии файлов

**Использование**:
```bash
# Применить конкретный патч
./patch.sh settings.patch

# Применить несколько патчей
./patch.sh settings.patch other.patch
```

---

## update_api.sh

**Назначение**: Скрипт для обновления API VSCode до последней версии.

**Ключи командной строки**:
- `-i` - Обновить инсайдерскую версию

**Особенности**:
- Загружает последнюю версию VSCode с официального сайта
- Распаковывает архив с бинарниками
- Обновляет необходимые файлы API

**Использование**:
```bash
# Обновить стабильную версию
./update_api.sh

# Обновить инсайдерскую версию
./update_api.sh -i
```

---

## update_patches.sh

**Назначение**: Утилита для обновления патчей при обновлении версии VSCode.

**Ключи командной строки**:
- `-i` - Работать с инсайдерской версией

**Особенности**:
- Автоматически разрешает конфликты при применении патчей
- Создает коммиты для отслеживания изменений
- Позволяет вручную разрешать сложные конфликты

**Использование**:
```bash
# Обновить патчи для стабильной версии
./update_patches.sh

# Обновить патчи для инсайдерской версии
./update_patches.sh -i
```

---

## Общие рекомендации

1. **Перед сборкой** убедитесь, что у вас установлены все необходимые зависимости.
2. Для **отладки** используйте флаги `-v` или `--verbose` для получения подробного вывода.
3. При возникновении **ошибок** проверьте логи в директории `logs/`.
4. Для **чистой сборки** удалите директории `vscode` и `VSCode-*`.
5. Используйте **Docker** для изолированной сборки, чтобы избежать проблем с зависимостями.

## Примечания

- Все скрипты должны быть исполняемыми. Если у вас возникли проблемы с правами, выполните:
  ```bash
  chmod +x *.sh
  ```

- Для работы скриптов требуется установленный Git, Node.js и другие зависимости, указанные в документации VSCodium.

- При возникновении проблем с зависимостями обратитесь к официальной документации VSCodium.
